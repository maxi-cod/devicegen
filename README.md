# Документация проекта Device Generator

## Описание проекта
Проект **Device Generator** представляет собой библиотеку на Python для генерации случайных конфигураций устройств для различных платформ (macOS, Windows, Linux, Android, iOS). Генерация основана на данных из JSON-файлов, содержащих информацию о моделях устройств, версиях систем, языковых настройках и других параметрах. Проект позволяет создавать JSON-представления устройств с учетом уникального идентификатора пользователя.

## Основные компоненты

### 1. `device_generator.py`
Основной модуль, содержащий логику генерации устройств. Ключевые элементы:

- **Класс `DeviceInfo`**: Хранит информацию о конфигурации устройства (модель, версия системы, языковые коды, версия приложения, API ID и hash).
- **Класс `BaseDeviceGenerator`**: Базовый класс для генерации устройств, содержащий методы для загрузки данных из JSON, генерации случайных устройств и хеширования идентификаторов.
- **Классы для платформ**: `WindowsDevice`, `LinuxDevice`, `macOSDevice`, `AndroidDevice`, `iOSDevice` наследуются от `BaseDeviceGenerator` и задают специфичные параметры для каждой платформы.
- **Функция `get_random_device`**: Точка входа для генерации устройства для указанной платформы.

### 2. `example.py`
Скрипт, демонстрирующий использование библиотеки. Перебирает поддерживаемые платформы, генерирует устройство для каждой и выводит результат в формате JSON.

### 3. JSON-файлы (`ios.json`, `macos.json`, `linux.json`, `windows.json`, `android.json`)
Содержат данные для генерации устройств:
- `device_models`: Список моделей устройств или словарь для сложных структур (например, iOS).
- `system_versions`: Версии операционных систем.
- `lang_codes` и `system_lang_codes`: Языковые коды.
- `app_versions`: Версии приложения.
- `lang_packs`: Языковые пакеты.
- `api_id` и `api_hash`: Идентификаторы API.

## Установка и настройка

1. **Требования**:
   - Python 3.8+
   - Библиотеки: `json`, `hashlib`, `os`, `pathlib`, `dataclasses`, `typing`.

2. **Установка**:
   - Поместите файлы `device_generator.py` и JSON-файлы в директорию проекта.
   - Убедитесь, что JSON-файлы находятся в папке `data` (или укажите другой путь через параметр `data_dir`).

3. **Запуск примера**:
   ```bash
   python example.py
   ```

## Использование

### Пример вызова
```python
from device_generator import get_random_device
import json

platform = "iOS"
device_json = get_random_device(platform, unique_id="user123", data_dir="data")
device = json.loads(device_json)
print(json.dumps(device, indent=2, ensure_ascii=False))
```

### Параметры функции `get_random_device`
- `platform`: Платформа устройства (`macOS`, `Windows`, `Linux`, `Android`, `iOS`).
- `unique_id`: Уникальный идентификатор пользователя (строка, опционально).
- `data_dir`: Путь к директории с JSON-файлами (по умолчанию `data`).

### Выходные данные
Функция возвращает JSON-строку с объектом `DeviceInfo`, содержащим:
- `device_model`: Модель устройства.
- `system_version`: Версия операционной системы.
- `lang_code`: Код языка приложения.
- `system_lang_code`: Код языка системы.
- `app_version`: Версия приложения.
- `lang_pack`: Языковой пакет.
- `api_id`: Идентификатор API.
- `api_hash`: Хеш API.

## Логика работы

1. **Загрузка данных**:
   - Метод `load_data` загружает JSON-файл для указанной платформы.
   - Данные заполняют списки моделей, версий, языков и других параметров.

2. **Генерация устройства**:
   - Уникальный идентификатор (`unique_id`) преобразуется в хеш с помощью SHA-1.
   - Хеш используется для выбора случайных значений из списков с помощью метода `_hash_to_value`.

3. **Создание списка устройств**:
   - Для iOS: Комбинируются модели (например, `iPhone 17 Pro`) и версии системы (например, `17.4.1`).
   - Для других платформ: Перебираются списки моделей и версий для создания объектов `DeviceInfo`.

4. **Возврат результата**:
   - Выбранное устройство преобразуется в словарь и возвращается как JSON-строка.

## Обработка ошибок
- **Отсутствие JSON-файла**: Вызывается исключение `FileNotFoundError`.
- **Неподдерживаемая платформа**: Вызывается исключение `ValueError`.
- **Пустые списки значений**: Вызывается исключение `ValueError`.

## Примечания
- JSON-файлы должны быть корректно сформированы и содержать все необходимые ключи.
- Для iOS используется сложная структура `device_models` и `system_versions`, что требует особой обработки в методе `_generate`.
- Хеширование `unique_id` обеспечивает детерминированную генерацию для одного и того же идентификатора.

## Расширение проекта
- Добавить поддержку новых платформ, создав новые классы, унаследованные от `BaseDeviceGenerator`.
- Расширить JSON-файлы для поддержки дополнительных моделей, версий или параметров.
- Добавить валидацию JSON-файлов перед загрузкой.
